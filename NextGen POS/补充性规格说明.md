## 补充性规格说明

### 修订历史

|   版本   |     日期      |                 描述                 | 作者 |
| :------: | :-----------: | :----------------------------------: | :--: |
| 初始草案 | 2021年1月18日 | 第一个草案。主要在细化阶段中进行精化 | sun  |
|          |               |                                      |      |

### 简介

本文档记录了NextGen POS所有未在用例中描述的需求。

### 功能性

（通常跨越多个用例的功能性）

1. 日志和错误处理

   在持久性存储中记录所有的错误。

2. 可插拔规则

   在几个用例（见定义）的不同场景点执行任意一组规则，以支持对系统功能的定制。

3. 安全性

   任何使用都需要经过用户认证。

### 可用性

人性因素

顾客将能够看到POS大屏幕显示器。因此：

- 应该在1米外轻松看到文本。
- 避免使用一般色盲人群难以辨认的颜色。

快捷、无错的销售交易处理极为重要，因为购买者希望快速离开，否则会给他们的购买体验（和对销售员的评价）带来负面影响。

收银员的实现通常停留在顾客或商品，而不是计算机显示器上。因此提示和告警应该通过声音传递而不仅仅是通过图像传递。

### 可靠性

1. 可恢复性
如果在使用外部服务（支付授权、账务系统、......）时出现错误，为了完成销售交易，需要尝试采
用本地方案（如存储和转发）加以解决。对此需要更深入的分析......
2. 性能
正如“人性因素”一节中所提及的，购买者希望非常快速地完成销售处理过程。外部的支付授权是瓶
颈之一。我们的目标是：90%的情况下，能够在1分钟之内完成授权。

### 可支持性

1. 可适应性
NextGen POS的不同客户在处理销售时有其特有的业务规则和处理需求。因此，在场景中的几个
预定之处（例如，当开始新的销售交易时，当增加新的商品时），需要能够启用可插拔的业务规
则。
2. 可配置性
不同的客户对其POS系统有不同的网络配置需求，例如，采用胖客户端或瘦客户端，两层或多层
物理结构等等。除此之外，他们还要求具备修改配置的能力，以便适应其变更业务和性能的需求。
因此，系统应该具备一定的可配置能力以适应这些需求。对此需要进一步分析，以发现哪些地方需
要灵活性和灵活性的程度，以及实现这种灵活性所需的工作。

### 实现约束

NextGen的领导层坚持采用Java技术的解决方案，他们认为采用Java技术除了易于开发外，还能够
提高远期的移植和可支持能力。

### 购买构件

- 税金计算机。必须支持用于不同国家的可插拔计算机。

### 免费开源构件

一般而言，我们建议在该项目中尽可能地使用免费的Java技术开源构件。
尽管现在对确定最终的设计和选择构件来说为时尚早，但是我们还是建议采用以下构件：

- JLog日志框架
- ......

### 接口

1. 重要硬件和接口

  - 触摸屏（操作系统将此视为普通监视器，且触摸动作也视为鼠标事件）。
  - 条形码激光扫描仪（通常附加在一种特殊键盘上，扫描输入在软件中视为键盘输入）。
  - 票据打印机。
  - 信用卡/借记卡读卡器
  - 签名读取装置。

2. 软件接口

  由于存在众多外部协作系统，我们需要采用不通过的接口，接入不同的系统。

### 应用的领域（业务）规则

（一般性规则参见单独的业务规则文档。）

|  ID   | 规则                                                         | 可变性                                                     |    来源    |
| :---: | :----------------------------------------------------------- | :--------------------------------------------------------- | :--------: |
| 规则1 | 购买者折扣规则。示例：<br />员工：20%折扣额<br />优先顾客：10%折扣额<br />高级：15%折扣额 | 高<br />每个零售商有不同的规则                             | 零售商政策 |
| 规则2 | 销售（交易级）折扣规则适用于税前总额。示例：<br />如果超过100美元，折扣额为10%<br />每周一折扣额为5%<br />每天上午10点到下午3点的折扣额为10%<br />每天上午9点到上午10点，豆腐的折扣额为50% | 高<br />每个零售商有不同规则，<br />每天或每小时都可能改变 | 零售商政策 |
| 规则3 | 产品（商品级）折扣规格。示例：<br />割草机本周折扣额为10%<br />汉堡买二送一 | 高<br />每个零售商有不同规则，<br />每天或每小时都可能改变 | 零售商政策 |

### 法律问题

我们建议使用一些开源构件，但是要解决其许可限制的问题，以便使包含开源软件的产品能够转售。

法律规定，在销售交易中必须遵从所有税务规则。同时要注意的是，这些规则可以频繁变更。

### 所关注领域内的信息

1. 定价

   除了在“应用的领域规则”小节中描述的定价规则之外，还需要注意，产品有`原始价格`和可选的`常设低标价`之分。产品标示的价格（折扣前）是常设低标价。由于账务和税务的原因，即使有常设低标价，也需要维护原始价格。

2. 信用卡和借记卡支付处理

   当支付授权服务批准了信用卡或借记卡支付后，将由支付授权服务而不是买方来负责对卖方的支付。因此，对于每笔支付，卖方都需要将支付授权服务的未付金额记录于其应收账户下。通常，授权服务在每晚执行电子转账操作，将卖方当天的应收总额转入其账户下，同时每笔交易扣除（少量的）服务费。

3. 销售税

   销售税的计算可能会十分复杂，并且会根据各级政府的立法而定期变更。因此，对税金计算采用第三方软件（存在许多可选的第三方软件）是明智之举。税金可能分别归属于城市、地区、省和国家。某些商品可能是无条件免税的，或者是根据买方或目标承受者（例如，成人或儿童）进行免税。

4. 商品标识：UPC、EAN、SKU、条形码和条形码读取装置

   NextGen POS要支持各种商品标识方案。对于出售的产品而言，UPC（通用产品代码）、EAN（欧洲物品编码）和SKU（库存单位）是三种常见的商品销售标识系统。JAN（日本物品编码）类似于EAN。

   SKU是由零售商定义的完全专用的标识。

   无论如何，UPC和EAN具有标准和受规章限制的构件。参见 www.adams1.com/pub/russadam/upccode.html 或者 www.uc-council.org 和 www.ean-int.org 获得详细信息。

